<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      :root {
        color-scheme: dark light;
      }

      input[type="text"]:focus {
        outline: none;
      }

      input,
      select {
        font-size: 13.3px;
      }

      input[type="radio"] {
        margin: 0px;
      }

      .sqft-select-container {
        gap: 5px;
        display: flex;
        padding-top: 3px;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <table style="zoom: 1.3">
      <tr>
        <td colspan="2">
          Input mode
          <select id="input_mode">
            <option value="text">Text</option>
            <option value="decimal">Decimal</option>
            <option value="numeric">Numeric</option>
          </select>
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <div class="sqft-select-container">
            Sqft in marla
            <input type="radio" name="sqft" id="sqft_272_25" />
            <label for="sqft_272_25">272.25</label>
            <input type="radio" name="sqft" id="sqft_272" />
            <label for="sqft_272">272</label>
          </div>
        </td>
      </tr>
      <tr>
        <td><br /></td>
      </tr>
      <tr>
        <td><label for="sqft">Sqft:</label></td>
        <td><input type="text" id="sqft" /></td>
      </tr>
      <tr>
        <td>↕️</td>
      </tr>
      <tr>
        <td><label for="acres">Acre:</label></td>
        <td><input type="text" id="acres" /></td>
      </tr>
      <tr>
        <td><label for="kanal">Kanal:</label></td>
        <td><input type="text" id="kanal" /></td>
      </tr>
      <tr>
        <td><label for="marla">Marla:</label></td>
        <td><input type="text" id="marla" /></td>
      </tr>
      <tr>
        <td><label for="rsqft">Sqft:</label></td>
        <td><input type="text" id="rsqft" /></td>
      </tr>
    </table>
    <script>
      function setInputMode(mode) {
        input_mode.value = mode
        sqft.inputMode = mode
        acres.inputMode = mode
        kanal.inputMode = mode
        marla.inputMode = mode
        rsqft.inputMode = mode
      }

      setInputMode(localStorage.getItem("inputMode") || "numeric")

      input_mode.onchange = () => {
        setInputMode(input_mode.value)
        localStorage.setItem("inputMode", input_mode.value)
      }

      preferredSqftsInAcre =
        Number(localStorage.getItem("preferredSqftsInAcre")) || 43560

      if (preferredSqftsInAcre === 43560) sqft_272_25.checked = true
      else sqft_272.checked = true

      let sqftsInAcre = preferredSqftsInAcre
      let sqftsInKanal = sqftsInAcre / 8
      let sqftsInMarla = sqftsInKanal / 20

      sqft_272_25.onclick = () => {
        sqftsInAcre = 43560
        sqftsInKanal = sqftsInAcre / 8
        sqftsInMarla = sqftsInKanal / 20
        sqft.oninput()
        localStorage.setItem("preferredSqftsInAcre", "43560")
      }

      sqft_272.onclick = () => {
        sqftsInAcre = 43520
        sqftsInKanal = sqftsInAcre / 8
        sqftsInMarla = sqftsInKanal / 20
        sqft.oninput()
        localStorage.setItem("preferredSqftsInAcre", "43520")
      }

      sqft.oninput = (e) => {
        sqftValue = Number(sqft.value)
        let invalidInput = false

        if (
          isNaN(sqftValue) ||
          Math.sign(sqftValue) === -1 ||
          !Number.isFinite(sqftValue)
        )
          invalidInput = true

        sqft.style.color = invalidInput ? "red" : ""

        if (invalidInput) return

        acres.style.color = ""
        kanal.style.color = ""
        marla.style.color = ""
        rsqft.style.color = ""

        acres.value = Math.floor(sqftValue / sqftsInAcre)
        kanal.value = Math.floor((sqftValue % sqftsInAcre) / sqftsInKanal)
        marla.value = Math.floor((sqftValue % sqftsInKanal) / sqftsInMarla)
        rsqft.value = Number((sqftValue % sqftsInMarla).toFixed(2))
      }

      acres.oninput =
        kanal.oninput =
        marla.oninput =
        rsqft.oninput =
          () => {
            const acresValue = Number(acres.value)
            const kanalValue = Number(kanal.value)
            const marlaValue = Number(marla.value)
            const rsqftValue = Number(rsqft.value)
            const invalidInputs = [false, false, false, false]

            if (
              isNaN(acresValue) ||
              Math.sign(acresValue) === -1 ||
              !Number.isInteger(acresValue)
            )
              invalidInputs[0] = true
            if (
              isNaN(kanalValue) ||
              Math.sign(kanalValue) === -1 ||
              !Number.isInteger(kanalValue)
            )
              invalidInputs[1] = true
            if (
              isNaN(marlaValue) ||
              Math.sign(marlaValue) === -1 ||
              !Number.isInteger(marlaValue)
            )
              invalidInputs[2] = true
            if (
              isNaN(rsqftValue) ||
              Math.sign(rsqftValue) === -1 ||
              !Number.isFinite(rsqftValue)
            )
              invalidInputs[3] = true

            acres.style.color = invalidInputs[0] ? "red" : ""
            kanal.style.color = invalidInputs[1] ? "red" : ""
            marla.style.color = invalidInputs[2] ? "red" : ""
            rsqft.style.color = invalidInputs[3] ? "red" : ""

            if (invalidInputs.some((e) => e)) return

            sqft.style.color = ""

            sqft.value = Number(
              (
                acresValue * sqftsInAcre +
                kanalValue * sqftsInKanal +
                marlaValue * sqftsInMarla +
                rsqftValue
              ).toFixed(2)
            )
          }
    </script>
  </body>
</html>
